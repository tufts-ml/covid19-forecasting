# Sampling code, towards ABC Sampler
Gian Marco Visani - 06/02/2020

## Simplified model and setup

The code thus far aims at recovering the parameters of a simple patient trajectory, one where patients are only *declining*, thus they only move from state to state until they reach the terminal state.

Furthermore, for now we assume the number of presenting patients to be known, and thus we do not model it. We only aim to model the parameters of a categorical distribution over the time (duration) each patient spends in each state. Thus, specify the number of presenting patients in a file that also specifies the number of timesteps (i.e. num_presenting_simple-##days.csv)

*True* summary statistics (census, admissions, etc.) are generated by `run_forecast.py`, which uses `SimplePatientTrajectory.py`. The code works analogously to the current semimarkov forecaster model.

Specify the config file in the same manner as the current model, but append to the name the number of timesteps to simulate (i.e. params_simple-##days.json)

----------------------------------------------------------------------------------

## Sampling 

The sampling code is in file `sampling.py`. I have documented it as much as possible. Please reach out to me via email or slack if you have any questions!

What has been implemented:
    1) Running multiple simulations with a fixed set of parameters, in order to explore the average distance between the simulated and true summary statistics.
    2) A hill-climbing-like sampling procedure that accepts new parameters (theta) if they produce summary statistics that are closer to the truth than the current best parameters. This procedure achieves reasonable results.
    3) ABC Sampling procedure as described in https://arxiv.org/pdf/1001.2058.pdf, Table 1.2. It currently does not work perfectly. I think I have implemented it correctly. I have tried by starting with a high value of epsilon and then annealing it over iterations. One issue is how to decide on a lower bound. Zero is not a viable option since it is basically impossible to achieve the same exact summary statistics even with the true parameters (try it yourself with my implementation that runs multiple simulations using the same parameters).

**Dependencies**
    - Those in semimarkov_forecaster.yml, plus *copy*. @Mike please add it to semimarkov_forecaster.yml (I am not sure how to do it).

## TODO
    - Try a simulated-annealing-like procedure: start from implementation #2 and modify it so it becomes more like simulated annealing.